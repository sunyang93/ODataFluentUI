<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="../css/site.css" rel="stylesheet" />
    <link href="../lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../lib/handsontable/dist/handsontable.css" rel="stylesheet" />
</head>
<body>
    <div class="bg"></div>
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top bg-success">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">OdataFluentUI</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="odata.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-xml" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2v-1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM3.527 11.85h-.893l-.823 1.439h-.036L.943 11.85H.012l1.227 1.983L0 15.85h.861l.853-1.415h.035l.85 1.415h.908l-1.254-1.992 1.274-2.007Zm.954 3.999v-2.66h.038l.952 2.159h.516l.946-2.16h.038v2.661h.715V11.85h-.8l-1.14 2.596h-.025L4.58 11.85h-.806v3.999h.706Zm4.71-.674h1.696v.674H8.4V11.85h.791v3.325Z" />
                            </svg>
                            Odata
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="openapi.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-json" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM4.151 15.29a1.176 1.176 0 0 1-.111-.449h.764a.578.578 0 0 0 .255.384c.07.049.154.087.25.114.095.028.201.041.319.041.164 0 .301-.023.413-.07a.559.559 0 0 0 .255-.193.507.507 0 0 0 .084-.29.387.387 0 0 0-.152-.326c-.101-.08-.256-.144-.463-.193l-.618-.143a1.72 1.72 0 0 1-.539-.214 1.001 1.001 0 0 1-.352-.367 1.068 1.068 0 0 1-.123-.524c0-.244.064-.457.19-.639.128-.181.304-.322.528-.422.225-.1.484-.149.777-.149.304 0 .564.05.779.152.217.102.384.239.5.41.12.17.186.359.2.566h-.75a.56.56 0 0 0-.12-.258.624.624 0 0 0-.246-.181.923.923 0 0 0-.37-.068c-.216 0-.387.05-.512.152a.472.472 0 0 0-.185.384c0 .121.048.22.144.3a.97.97 0 0 0 .404.175l.621.143c.217.05.406.12.566.211a1 1 0 0 1 .375.358c.09.148.135.335.135.56 0 .247-.063.466-.188.656a1.216 1.216 0 0 1-.539.439c-.234.105-.52.158-.858.158-.254 0-.476-.03-.665-.09a1.404 1.404 0 0 1-.478-.252 1.13 1.13 0 0 1-.29-.375Zm-3.104-.033a1.32 1.32 0 0 1-.082-.466h.764a.576.576 0 0 0 .074.27.499.499 0 0 0 .454.246c.19 0 .33-.055.422-.164.091-.11.137-.265.137-.466v-2.745h.791v2.725c0 .44-.119.774-.357 1.005-.237.23-.565.345-.985.345a1.59 1.59 0 0 1-.568-.094 1.145 1.145 0 0 1-.407-.266 1.14 1.14 0 0 1-.243-.39Zm9.091-1.585v.522c0 .256-.039.47-.117.641a.862.862 0 0 1-.322.387.877.877 0 0 1-.47.126.883.883 0 0 1-.47-.126.87.87 0 0 1-.32-.387 1.55 1.55 0 0 1-.117-.641v-.522c0-.258.039-.471.117-.641a.87.87 0 0 1 .32-.387.868.868 0 0 1 .47-.129c.177 0 .333.043.47.129a.862.862 0 0 1 .322.387c.078.17.117.383.117.641Zm.803.519v-.513c0-.377-.069-.701-.205-.973a1.46 1.46 0 0 0-.59-.63c-.253-.146-.559-.22-.916-.22-.356 0-.662.074-.92.22a1.441 1.441 0 0 0-.589.628c-.137.271-.205.596-.205.975v.513c0 .375.068.699.205.973.137.271.333.48.589.626.258.145.564.217.92.217.357 0 .663-.072.917-.217.256-.146.452-.355.589-.626.136-.274.205-.598.205-.973Zm1.29-.935v2.675h-.746v-3.999h.662l1.752 2.66h.032v-2.66h.75v4h-.656l-1.761-2.676h-.032Z" />
                            </svg>
                            OpenApi
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div>
            <div class="input-group">
                <span class="input-group-text" id="basic-addon1">Url</span>
                <input id="odataUri" type="url" class="form-control" placeholder="http://website/odata/$metadata">
                <button class="btn btn-outline-primary" type="button" onclick="SearchOdata()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
                </button>
                <a id="odataXmlMetadataA" class="btn btn-outline-primary" href="#" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filetype-xml" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M14 4.5V14a2 2 0 0 1-2 2v-1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5L14 4.5ZM3.527 11.85h-.893l-.823 1.439h-.036L.943 11.85H.012l1.227 1.983L0 15.85h.861l.853-1.415h.035l.85 1.415h.908l-1.254-1.992 1.274-2.007Zm.954 3.999v-2.66h.038l.952 2.159h.516l.946-2.16h.038v2.661h.715V11.85h-.8l-1.14 2.596h-.025L4.58 11.85h-.806v3.999h.706Zm4.71-.674h1.696v.674H8.4V11.85h.791v3.325Z" />
                    </svg>
                </a>
            </div>
            <div id="tableDiv">
                <div class="input-group">
                    <span class="input-group-text" id="basic-addon1">Entity</span>
                    <select class="form-select" onchange="OnEntityTypeChange(this)">
                        <option value="" selected>请选择一个Entity</option>
                        <option v-for="entityType in entityTypes">
                            {{entityType.name}}
                        </option>
                    </select>
                    <span class="input-group-text" id="basic-addon1">Url</span>
                    <input id="odataEntityUri" type="url" class="form-control" placeholder="Search Entity Dataset">
                    <button class="btn btn-outline-primary" type="button" onclick=" QueryEntityDataset()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                        </svg>
                    </button>
                    <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-grid-3x3-gap-fill" viewBox="0 0 16 16">
                            <path d="M1 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2zM1 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V7zM1 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z" />
                        </svg>
                    </button>
                </div>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped table-hover table-borderless table-light">
                                <tbody>
                                    <tr>
                                        <th scope="row" style="min-width:60px">列头</th>
                                        <template v-for="header in currentHandsonTableAccessories.colHeaders">
                                            <td>{{ header }}</td>
                                        </template>
                                    </tr>
                                    <tr>
                                        <th scope="row">类型</th>
                                        <template v-for="column in currentHandsonTableAccessories.columns">
                                            <td>{{ column.type }}</td>
                                        </template>
                                    </tr>
                                    <tr>
                                        <th scope="row">格式化</th>
                                        <template v-for="column in currentHandsonTableAccessories.columns">
                                            <td>{{ column.dateFormat }}</td>
                                        </template>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-sm table-striped table-hover table-borderless table-light">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">名称</th>
                                        <th scope="col">数据类型</th>
                                        <th scope="col">默认值</th>
                                        <th scope="col">编辑器</th>
                                        <th scope="col">编辑器类型</th>
                                        <th scope="col">必填</th>
                                        <th scope="col">只读</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(property,index) in currentEntityType.propertys" :key="property.name">
                                        <th scope="row">{{ index+1 }}</th>
                                        <td v-if="currentEntityType.keys.includes(property.name)">
                                            {{ property.name }}
                                            <span title="主键">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-key-fill" viewBox="0 0 16 16">
                                                    <path d="M3.5 11.5a3.5 3.5 0 1 1 3.163-5H14L15.5 8 14 9.5l-1-1-1 1-1-1-1 1-1-1-1 1H6.663a3.5 3.5 0 0 1-3.163 2zM2.5 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                                                </svg>
                                            </span>
                                        </td>
                                        <td v-else>
                                            {{ property.name }}
                                        </td>
                                        <td>{{ property.dataType }}</td>
                                        <td>{{ property.defaultValue }}</td>
                                        <td v-if="property.editor==='input'">
                                            输入框
                                        </td>
                                        <td v-else-if="property.editor==='select'">
                                            下拉列表
                                        </td>
                                        <td v-else>
                                        </td>
                                        <td v-if="property.editorType==='text'">
                                            文本
                                        </td>
                                        <td v-else-if="property.editorType==='number'">
                                            数字
                                        </td>
                                        <td v-else-if="property.editorType==='date'">
                                            日期
                                        </td>
                                        <td v-else-if="property.editorType==='checkbox'">
                                            复选框
                                        </td>
                                        <td v-else>
                                        </td>
                                        <td v-if="property.required==true">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                            </svg>
                                        </td>
                                        <td v-else>
                                        </td>
                                        <td v-if="property.readonly==true">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                            </svg>
                                        </td>
                                        <td v-else>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div>
                    <template v-for="property in currentEntityType.propertys">                       
                        <template v-if="property.editor==='input'">
                            <template v-if="property.editorType==='checkbox'">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" v-bind:id="property.name">
                                    <label class="form-check-label" v-bind:for="property.name">
                                        {{ property.name }}
                                    </label>
                                </div>
                            </template>
                            <template v-else-if="property.editorType==='datetime'">
                                <div class="mb-3">
                                    <label class="form-label">{{ property.name }}</label>
                                    <input v-bind:type="property.editorType" class="form-control" />
                                </div>
                            </template>
                            <template v-else>
                                <div class="mb-3">
                                    <label class="form-label">{{ property.name }}</label>
                                    <input v-bind:type="property.editorType" class="form-control"
                                           :readonly="property.readonly?'readonly':false" 
                                           :disabled="property.readonly?'disabled':false"/>
                                </div>                             
                            </template>                           
                        </template>
                        <template v-else-if="property.editor==='select'">
                            <div class="mb-3">
                                <label class="form-label">{{ property.name }}</label>
                                <select class="form-select">
                                    <option v-for="enumValue in property.enumValues" v-bind:value="enumValue.value">{{enumValue.name}}</option>
                                </select>
                            </div>
                        </template>                        
                    </template>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped table-hover table-borderless table-light">
                        <thead>
                            <tr>
                                <template v-for="header in currentHandsonTableAccessories.colHeaders">
                                    <th scope="col">{{ header }}</th>
                                </template>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="entity in currentEntitySet">
                                <td v-for="header in currentHandsonTableAccessories.colHeaders">   
                                    {{ entity[header] }}   
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div class="col">
                        <p class="text-start text-light">共<span id="totalCountSpan" class="badge rounded-pill bg-success">0</span>条数据</p>
                    </div>
                    <div class="col text-center">
                        <a class="btn btn-outline-primary" href="#" role="button" onclick="previousPage()">
                            上一页
                        </a>
                        <a class="btn btn-outline-primary" href="#" role="button" onclick="nextPage()">
                            下一页
                        </a>
                    </div>
                    <div class="col">
                        <p class="text-end text-light">
                            第【<input id="pageInput" type="number" class="inputMaxWidth text-center" value="1" min="1" />】页，共<span id="totalPageSpan" class="badge rounded-pill bg-success">0</span>页，每页<input id="pageSizeInput" type="number" class="inputMaxWidth text-center" value="15" min="1" max="5000" />条数据
                        </p>
                    </div>

                </div>
            </div>
        </div>

        <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1200">
            <div id="liveToast" class="toast fade" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-primary">
                    <strong class="me-auto text-white">操作通知</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    查询OdataWebApi元数据成功
                </div>
            </div>
        </div>
    </div>

    <script src="../lib/jquery/dist/jquery.js"></script>

    <script src="../lib/bootstrap/dist/js/bootstrap.js"></script>

    <script src="../lib/vue/dist/vue.js"></script>

    <script src="../lib/odatajs/odatajs-4.0.0.js"></script>

    <script type="text/javascript">
        'use strict';

        const defaultOdataApiUrl = 'http://localhost:5201/odata';
        const defaultOdataApiMetadataUrl = `${defaultOdataApiUrl}/$metadata`;
        document.getElementById('odataUri').value = defaultOdataApiMetadataUrl;
        document.getElementById('odataXmlMetadataA').setAttribute('href',defaultOdataApiMetadataUrl);
        let entityVm = new Vue({
            el: '#tableDiv',
            data: {
                handsonTableAccessories: [],
                currentHandsonTableAccessories: {},
                entityTypes: [],
                currentEntityType: {},
                currentEntitySet:[]
                //enumTypes: [],
                //currentEnumTypes:[]
            }
        })

        $(function () {
            SearchOdata();
        });

        let metadata = { _xml: null, _json: null, _entity: null };

        function SearchOdata() {
            QueryOdataMetadata();
        }

        function QueryOdataMetadata() {
            let uri = $('#odataUri').val();
            $.get(uri, function (data, status, xhr) {
                metadata._xml = data;
                metadata._json = MapperOdataMetadata(metadata._xml);
                metadata._entity = GenerateEditorConfig(metadata._json);

                entityVm._data.handsonTableAccessories = metadata._json.handsonTableAccessories;
                entityVm._data.entityTypes = metadata._entity;

                ToastQueryResult();
            }, 'xml');
        };

        function ToastQueryResult() {
            let toastLiveExample = document.getElementById('liveToast');
            let toast = new bootstrap.Toast(toastLiveExample)
            toast.show();
        }


        function OnEntityTypeChange(e) {
            let entityName = $(e).val();
            if (entityName !== '') {
                document.getElementById('odataEntityUri').value = `${defaultOdataApiUrl}/${entityName}`;
            } else {
                document.getElementById('odataEntityUri').value = '';
            }

            let entityType = metadata._entity.find(d => d.name === entityName);
            if (entityType == undefined) {
                entityVm._data.currentEntityType = {};
            }
            else {
                entityVm._data.currentEntityType = entityType;
            }

            let accessories = metadata._json.handsonTableAccessories.find(d => d.entityName === entityName);
            if (accessories == undefined) {
                entityVm._data.currentHandsonTableAccessories = {};
            }
            else {
                entityVm._data.currentHandsonTableAccessories = accessories;
            }
            QueryEntityDataset();
        }

        function QueryEntityDataset() {
            let url = document.getElementById("odataEntityUri").value;
            let page = document.getElementById("pageInput").value;
            let pageSize = document.getElementById("pageSizeInput").value;
            let skip = (page - 1) * pageSize;
            let uri = `${url}?$count=true&$top=${pageSize}&$skip=${skip}`;
            let request = {
                requestUri: uri,
                method: "GET",
                headers: { Accept: "application/json;odata.metadata=full;odata.streaming=true" }
            };

            odatajs.oData.request(
                request,
                function (data, response) {
                    let count = data['@odata.count'];
                    $("#totalCountSpan").html(count);
                    entityVm._data.currentEntitySet = data['value'];
                },
                function (err) {
                    alert("Something went wrong");
                }
            );
        }

        function previousPage() {
            let page = Number.parseInt(document.getElementById("pageInput").value);
            if (page > 1) {
                $("#pageInput").val(page - 1);
            }
            QueryEntityDataset();
        }

        function nextPage() {
            let page = Number.parseInt(document.getElementById("pageInput").value);
            $("#pageInput").val(page + 1);
            QueryEntityDataset();
        }

        function MapperOdataMetadata(odataXml, printLog = false) {
            let odataXmlDocuments = odataXml;// $.parseXML(odataXml);
            let entityTypes = $(odataXmlDocuments).find('EntityType');
            let handsonTableAccessories = [];
            let odata = { entityTypes: [], enumTypes: [] };
            $(entityTypes).each(function (entityTypeIndex, entityType) {
                let accessories = {}, entityT = { propertys: [] };
                let entityName = entityType.attributes.Name.value;
                accessories.entityName = entityName;
                entityT.name = entityName;
                let Propertys = $(entityType).find('Property');
                let colHeaders = [], columns = [];
                $(Propertys).each(function (propertyIndex, Property) {
                    let key = $($(entityType).find('Key')).first();
                    let propertyRefs = $(key).find('PropertyRef');
                    let keyRefs = [];
                    $(propertyRefs).each(function (refIndex, propertyRef) {
                        let keyName = propertyRef.attributes.Name.value;
                        keyRefs.push(keyName);
                    });
                    entityT.keys = keyRefs;
                    let column = {}, property = {};
                    let propertyAttributeName = Property.attributes.Name.value;
                    colHeaders.push(propertyAttributeName);
                    column.data = propertyAttributeName;
                    property.name = propertyAttributeName;
                    let propertyAttributeType = Property.attributes.Type.value;
                    property.dataType = propertyAttributeType;
                    if (Property.attributes.hasOwnProperty('Nullable')) {
                        let propertyAttributeNullable = Property.attributes.Nullable.value;
                        property.required = propertyAttributeNullable === "false" ? true : false;
                    }
                    else {
                        property.required = false;
                    }
                    if (Property.attributes.hasOwnProperty('DefaultValue')) {
                        let propertyAttributeDefaultValue = Property.attributes.DefaultValue.value;
                        property.defaultValue = propertyAttributeDefaultValue;
                    }
                    if (Property.attributes.hasOwnProperty('MaxLength')) {
                        let propertyAttributeMaxLength = Property.attributes.MaxLength.value;
                        property.maxLength = propertyAttributeMaxLength;
                    }
                    // https://docs.oasis-open.org/odata/odata-csdl-xml/v4.01/os/odata-csdl-xml-v4.01-os.html#sec_PrimitiveTypes
                    if (['Edm.Decimal', 'Edm.Double', 'Edm.Int16', 'Edm.Int32', 'Edm.Int64', 'Edm.Single',].includes(propertyAttributeType)) {
                        column.type = 'numeric';
                    }
                    else if (propertyAttributeType === 'Edm.Date') {
                        column.type = 'date';
                        column.dateFormat = 'YYYY-MM-DD';
                    }
                    else if (propertyAttributeType === 'Edm.DateTimeOffset') {
                        column.type = 'time';
                    }
                    else if (propertyAttributeType === 'Edm.Boolean') {
                        column.type = 'checkbox';
                    }
                    else if (propertyAttributeType.endsWith('EnumType')) {
                        column.type = 'dropdown';
                        let enumTypeName = propertyAttributeType.split('.')[1];
                        let enumTypes = $(odataXmlDocuments).find('EnumType');
                        $(enumTypes).each(function (enumTypeIndex, enumType) {
                            if (enumType.attributes.Name.value === enumTypeName) {
                                column.source = [];
                                property.enums = [];
                                let members = $(enumType).find('Member');
                                $(members).each(function (memberIndex, member) {
                                    let memberName = member.attributes.Name.value;
                                    let memberValue = member.attributes.Value.value;
                                    column.source.push(memberName);

                                    property.enums.push({ name: memberName, value: memberValue });
                                });
                            }
                        });
                    }
                    else {
                        column.type = 'text';
                    }
                    columns.push(column);

                    entityT.propertys.push(property);
                });
                accessories.colHeaders = colHeaders;
                accessories.columns = columns;
                handsonTableAccessories.push(accessories);

                odata.entityTypes.push(entityT);
            });

            let enumTypes = $(odataXmlDocuments).find('EnumType');
            $(enumTypes).each(function (enumTypeIndex, enumType) {
                let enumT = { enums: [] };
                let enumName = enumType.attributes.Name.value;
                enumT.name = enumName;
                let members = $(enumType).find('Member');
                $(members).each(function (memberIndex, member) {
                    let memberName = member.attributes.Name.value;
                    let memberValue = member.attributes.Value.value;
                    enumT.enums.push({ name: memberName, value: memberValue });
                });
                odata.enumTypes.push(enumT);
            });

            if (printLog) {
                console.log(JSON.stringify(handsonTableAccessories));
                console.log(JSON.stringify(odata));
            };
            return { handsonTableAccessories: handsonTableAccessories, odata: odata };
        };

        function GenerateEditorConfig(odataJson, printLog = false) {
            let configs = odataJson.odata.entityTypes;//JSON.parse(JSON.stringify(odata.entityTypes));
            $(configs).each(function (configIndex, config) {
                $(config.propertys).each(function (propertyIndex, property) {
                    property.editor = 'input';
                    if (['Edm.Decimal', 'Edm.Double', 'Edm.Int16', 'Edm.Int32', 'Edm.Int64', 'Edm.Single',].includes(property.dataType)) {
                        property.editorType = 'number';
                    }
                    else if (property.dataType === 'Edm.Date') {
                        property.editorType = 'date'; 
                    }
                    else if (property.dataType === 'Edm.DateTimeOffset') {
                        property.editorType = 'datetime-local';
                    }
                    else if (property.dataType === 'Edm.Boolean') {
                        property.editorType = 'checkbox';
                    }
                    else {
                        var enumType = odataJson.odata.enumTypes.find(d => d.name === property.dataType.split('.')[1])
                        if (enumType === undefined) {
                            property.editorType = 'text';
                        }
                        else {
                            property.editor = 'select';
                            property.enumValues = enumType.enums;
                        }
                    }
                    if (config.keys.includes(property.name)) {
                        property.readonly = true;
                    }
                    else {
                        property.readonly = false;
                    }
                });
            });
            return configs;
        }
    </script>
</body>
</html>