<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>视图页</title>
    <link href="../css/site.css" rel="stylesheet" />
    <link href="../lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="../css/sidebars.css" rel="stylesheet" />
    <link href="../lib/ag-grid-community/dist/styles/ag-grid.css" rel="stylesheet" />
    <link href="../lib/ag-grid-community/dist/styles/ag-theme-alpine.css" rel="stylesheet" />
</head>
<body class="font-monospace">
    <header>
        <nav class="navbar navbar-expand-md navbar-dark bg-success">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-strava" viewBox="0 0 16 16">
                        <path d="M6.731 0 2 9.125h2.788L6.73 5.497l1.93 3.628h2.766L6.731 0zm4.694 9.125-1.372 2.756L8.66 9.125H6.547L10.053 16l3.484-6.875h-2.112z" />
                    </svg>
                    OdataFluentUI
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarText">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" href="views.html">
                                Views
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" target="_blank" href="https://github.com/sunyang93/ODataFluentUI/issues">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bug" viewBox="0 0 16 16">
                                        <path d="M4.355.522a.5.5 0 0 1 .623.333l.291.956A4.979 4.979 0 0 1 8 1c1.007 0 1.946.298 2.731.811l.29-.956a.5.5 0 1 1 .957.29l-.41 1.352A4.985 4.985 0 0 1 13 6h.5a.5.5 0 0 0 .5-.5V5a.5.5 0 0 1 1 0v.5A1.5 1.5 0 0 1 13.5 7H13v1h1.5a.5.5 0 0 1 0 1H13v1h.5a1.5 1.5 0 0 1 1.5 1.5v.5a.5.5 0 1 1-1 0v-.5a.5.5 0 0 0-.5-.5H13a5 5 0 0 1-10 0h-.5a.5.5 0 0 0-.5.5v.5a.5.5 0 1 1-1 0v-.5A1.5 1.5 0 0 1 2.5 10H3V9H1.5a.5.5 0 0 1 0-1H3V7h-.5A1.5 1.5 0 0 1 1 5.5V5a.5.5 0 0 1 1 0v.5a.5.5 0 0 0 .5.5H3c0-1.364.547-2.601 1.432-3.503l-.41-1.352a.5.5 0 0 1 .333-.623zM4 7v4a4 4 0 0 0 3.5 3.97V7H4zm4.5 0v7.97A4 4 0 0 0 12 11V7H8.5zM12 6a3.989 3.989 0 0 0-1.334-2.982A3.983 3.983 0 0 0 8 2a3.983 3.983 0 0 0-2.667 1.018A3.989 3.989 0 0 0 4 6h8z" />
                                    </svg>
                                    Bug
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link active dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                                        <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
                                        <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z" />
                                    </svg>
                                    Config
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="config-entitytype.html">EntityType</a></li>
                                    <li><a class="dropdown-item" href="config-enumtype.html">EnumType</a></li>
                                    <li><a class="dropdown-item" href="config-entityset.html">EntitySet</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="config.html">OdataMetadata</a></li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link active dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-code-slash" viewBox="0 0 16 16">
                                        <path d="M10.478 1.647a.5.5 0 1 0-.956-.294l-4 13a.5.5 0 0 0 .956.294l4-13zM4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0z" />
                                    </svg>
                                    Development
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" target="_blank" href="/swagger">OpenApi</a></li>
                                    <li><a class="dropdown-item" target="_blank" href="http://47.112.160.131:9091/">DocFx</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" target="_blank" href="https://github.com/sunyang93/ODataFluentUI">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
                                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
                                    </svg>
                                    Github
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <main role="main" class="mt-1">
        <div class="container-fluid">
            <div id="entitySets">
                <div class="row">
                    <div class="col-auto shadow">
                        <div class="flex-shrink-0 p-3 bg-white">
                            <a href="#" class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
                                <span class="fs-5 fw-semibold">EntitySet</span>
                            </a>
                            <ul class="list-unstyled ps-0">
                                <li class="mb-1">
                                    <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#orders-collapse" aria-expanded="true">
                                        EntitySet
                                    </button>
                                    <div class="collapse show" id="orders-collapse">
                                        <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                            <li v-for="(entitySet,index) in configsViewModel">
                                                <a href="#" class="link-dark rounded" v-bind:id="entitySet.id" v-bind:name="entitySet.name" onclick="setCurrentEntitySet(this)">
                                                    {{entitySet.displayName}}
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group shadow mb-1">
                            <span class="input-group-text">EntitySet</span>
                            <input id="currentEntitySetName" type="text" class="form-control" v-bind:value="currentEntitySet.displayName" disabled>
                            <span class="input-group-text">
                                <span>Total</span>
                                <span id="totalCountSpan" class="badge rounded-pill bg-primary">0</span>
                            </span>
                            <span class="input-group-text">Top</span>
                            <input id="topOptions" type="number" class="form-control" value="12" min="1" placeholder="Top options">
                            <span class="input-group-text">Skip</span>
                            <input id="skipOptions" type="number" class="form-control" value="0" min="0" placeholder="Skip options" disabled>
                            <span class="input-group-text">Page</span>
                            <input id="pageOptions" type="number" class="form-control" value="1" min="1" placeholder="Page options">
                            <button class="btn btn-primary" type="button" onclick=" queryEntityDataSet()" title="查询EntitySet">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                                </svg>
                            </button>
                            <div class="btn-group" role="group">
                                <button id="btnGroupDrop1" type="button" title="查询选项" class="btn btn-primary dropdown-toggle" style="border-radius:0" data-bs-toggle="dropdown" aria-expanded="false">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z" />
                                    </svg>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                    <li>
                                        <a class="dropdown-item" onclick="clearSort()" href="#">
                                            清除所有排序
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" onclick="clearFilter()" href="#">
                                            清除所有筛选
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <button class="btn btn-primary" type="button" title="上一页" onclick="previousPage()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="下一页" onclick="nextPage()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="新建" onclick="createNewRecord()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square-fill" viewBox="0 0 16 16">
                                    <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="查看" onclick="viewDetail()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                    <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z" />
                                    <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="编辑" onclick="editRecord()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="删除" onclick="confirmDelete()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
                                </svg>
                            </button>
                            <button class="btn btn-primary" type="button" title="开发人员工具" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-code-slash" viewBox="0 0 16 16">
                                    <path d="M10.478 1.647a.5.5 0 1 0-.956-.294l-4 13a.5.5 0 0 0 .956.294l4-13zM4.854 4.146a.5.5 0 0 1 0 .708L1.707 8l3.147 3.146a.5.5 0 0 1-.708.708l-3.5-3.5a.5.5 0 0 1 0-.708l3.5-3.5a.5.5 0 0 1 .708 0zm6.292 0a.5.5 0 0 0 0 .708L14.293 8l-3.147 3.146a.5.5 0 0 0 .708.708l3.5-3.5a.5.5 0 0 0 0-.708l-3.5-3.5a.5.5 0 0 0-.708 0z" />
                                </svg>
                            </button>
                        </div>
                        <div id="myGrid" class="ag-theme-alpine h-100" style="min-height:550px"></div>
                    </div>
                </div>
                <!-- View Modal -->
                <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">详细信息</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <template v-for="property in currentEntityType.properties">
                                    <div class="form-floating mt-3">
                                        <textarea class="form-control" 
                                                  v-bind:id="property.name"
                                                 disabled>{{selectedEntityData[property.name]}}</textarea>
                                        <label v-bind:for="property.name">{{property.displayName}}</label>
                                    </div>
                                </template>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <!-- offcanvas -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <h5 id="offcanvasRightLabel">开发人员工具</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <button class="btn btn-primary form-control text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseQueryUrl" aria-expanded="false" aria-controls="collapseQueryUrl">
                Query Url
            </button>
            <div class="collapse show" id="collapseQueryUrl">
                <div class="card card-body p-0">
                    <div class="form-floating">
                        <textarea class="form-control" id="queryUrl" style="min-height:80px"></textarea>
                        <label for="floatingTextarea">Query Url</label>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary form-control text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilter" aria-expanded="false" aria-controls="collapseFilter">
                Filter
            </button>
            <div class="collapse show" id="collapseFilter">
                <div class="card card-body p-0">
                    <div class="form-floating">
                        <textarea class="form-control" id="filterOptions" style="min-height:80px"></textarea>
                        <label for="filterOptions">Filter</label>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary form-control text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSelect" aria-expanded="false" aria-controls="collapseSelect">
                Select
            </button>
            <div class="collapse show" id="collapseSelect">
                <div class="card card-body p-0">
                    <div class="form-floating">
                        <textarea class="form-control" id="selectOptions" style="min-height:80px"></textarea>
                        <label for="selectOptions">Select</label>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary form-control text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOrderBy" aria-expanded="false" aria-controls="collapseOrderBy">
                OrderBy
            </button>
            <div class="collapse show" id="collapseOrderBy">
                <div class="card card-body p-0">
                    <div class="form-floating">
                        <textarea class="form-control" id="orderByOptions" style="min-height:80px"></textarea>
                        <label for="orderByOptions">OrderBy</label>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary form-control text-start" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResponseBody" aria-expanded="false" aria-controls="collapseResponseBody">
                ResponseBody
            </button>
            <div class="collapse show" id="collapseResponseBody">
                <div class="card card-body p-0">
                    <div class="form-floating">
                        <textarea class="form-control" id="responseBody" style="min-height:300px"></textarea>
                        <label for="orderByOptions">ResponseBody</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="btn-group" role="group" aria-label="Basic example">

        </div>
    </div>
    <!-- 确认删除 Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">确认删除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    确定要删除该条数据么？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="deleteResource()">确认</button>
                </div>
            </div>
        </div>
    </div>
    <!--Toast-->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-primary text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-messenger" viewBox="0 0 16 16">
                    <path d="M0 7.76C0 3.301 3.493 0 8 0s8 3.301 8 7.76-3.493 7.76-8 7.76c-.81 0-1.586-.107-2.316-.307a.639.639 0 0 0-.427.03l-1.588.702a.64.64 0 0 1-.898-.566l-.044-1.423a.639.639 0 0 0-.215-.456C.956 12.108 0 10.092 0 7.76zm5.546-1.459-2.35 3.728c-.225.358.214.761.551.506l2.525-1.916a.48.48 0 0 1 .578-.002l1.869 1.402a1.2 1.2 0 0 0 1.735-.32l2.35-3.728c.226-.358-.214-.761-.551-.506L9.728 7.381a.48.48 0 0 1-.578.002L7.281 5.98a1.2 1.2 0 0 0-1.735.32z" />
                </svg>
                <strong class="me-auto" style="margin-left:4px"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">

            </div>
        </div>
    </div>
    <script src="../lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script src="../lib/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <script src="../lib/vue/dist/vue.js"></script>
    <script src="../lib/odatajs/odatajs-4.0.0.js"></script>
    <script src="../js/app.js"></script>
    <script>
        'use strict';

        const entitySetVm = new Vue({
            el: '#entitySets',
            data: {
                configsViewModel: [],
                currentEntitySet: {},
                currentEntityType: {},
                selectedEntityData: {}
            }
        });

        (function () {
            getEntitySetViewModel();
        })();

        // 查询EntitySetViewModel
        function getEntitySetViewModel() {
            let entitySetConfigsViewModelRequest = new Request(`${entitySetConfigsUri}/viewModel`, {
                method: "GET",
            });
            fetch(entitySetConfigsViewModelRequest)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    else {
                        throw new Error(`${response.status}:${response.statusText}`);
                    }
                })
                .then(data => {
                    entitySetVm._data.configsViewModel = data;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alertNotic("Something went wrong", "danger");
                });
        }

        // 查询EntitySetConfig
        function setCurrentEntitySet(e) {
            ResetQueryOptions();
            entitySetVm._data.currentEntitySet = entitySetVm._data.configsViewModel.find(d => d.id === e.id);

            // EntitySet
            let entitySetConfigsViewModelRequest = new Request(`${entitySetConfigsUri}/${e.id}`, {
                method: "GET",
            });
            fetch(entitySetConfigsViewModelRequest)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    else {
                        throw new Error(`${response.status}:${response.statusText}`);
                    }
                })
                .then(data => {
                    columnDefs = [];
                    let visibleProps = data.properties.map(d => {
                        if (d.isVisible) {
                            return d.name;
                        }
                    });
                    document.getElementById('selectOptions').value = visibleProps.join(',');
                    data.properties.forEach(function (column, index) {
                        let columnDef = {
                            headerName: column.displayName,
                            minWidth: 160,
                            field: column.name,
                            sortable: column.canSort,
                            filter: column.canFilter,
                        };
                        if (column.canFilter) {
                            if (column.dataType === "text") {
                                columnDef.filterParams = {
                                    caseSensitive: true,
                                    buttons: ['reset', 'apply'],
                                }
                            }
                            else if (column.dataType === "number") {
                                columnDef.filter = "agNumberColumnFilter";
                                columnDef.filterParams = {
                                    inRangeInclusive: true,
                                    buttons: ['reset', 'apply'],
                                }
                            }
                            else if (column.dataType === "date") {
                                columnDef.filter = "agDateColumnFilter";
                                columnDef.filterParams = {
                                    browserDatePicker: true,
                                    buttons: ['reset', 'apply'],
                                }
                            }
                            else if (column.dataType === "datetime") {
                                columnDef.filter = "agDateColumnFilter";
                                columnDef.filterParams = {
                                    browserDatePicker: false,
                                    buttons: ['reset', 'apply'],
                                }
                            }
                        }
                        columnDefs.push(columnDef);
                    })

                    gridOptions.api.setColumnDefs(columnDefs);

                    queryEntityDataSet();
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alertNotic(error, "danger");
                });
            // EntityType
            setTimeout(function () { queryEntityTypeConfig() }, 1000);

        }

        // 查询EntityTypeConfig
        function queryEntityTypeConfig() {
            let entityTypeConfigRequest = new Request(`${entityTypeConfigsUri}/${entitySetVm._data.currentEntitySet.entityTypeConfig.id}`, {
                method: "GET",
            });
            fetch(entityTypeConfigRequest)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    else {
                        throw new Error(`${response.status}:${response.statusText}`);
                    }
                })
                .then(data => {
                    entitySetVm._data.currentEntityType = data;
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alertNotic("Something went wrong", "danger");
                });
        }

        // 重置查询选项
        function ResetQueryOptions() {
            document.getElementById("pageOptions").value = 1;
            document.getElementById("skipOptions").value = 0;
            document.getElementById('orderByOptions').value = '';
            document.getElementById('filterOptions').value = '';
            document.getElementById('selectOptions').value = '';
        }

        // 上一页
        function previousPage() {
            let page = Number.parseInt(document.getElementById("pageOptions").value);
            if (page > 1) {
                document.getElementById("pageOptions").value = (page - 1);
                queryEntityDataSet();
            }
        };

        // 下一页
        function nextPage() {
            let page = Number.parseInt(document.getElementById("pageOptions").value);
            document.getElementById("pageOptions").value = (page + 1);
            queryEntityDataSet();
        };

        // Entity Dataset查询
        function queryEntityDataSet() {
            if (!entitySetVm._data.currentEntitySet.hasOwnProperty('name')) {
                return false;
            }
            let url = `${odataServiceUri}/${entitySetVm._data.currentEntitySet.name}`;
            let top = document.getElementById("topOptions").value;
            let page = Number.parseInt(document.getElementById("pageOptions").value);
            let skip = (page - 1) * top;
            document.getElementById("skipOptions").value = skip;
            let uri = `${url}?$count=true&$top=${top}&$skip=${skip}`;
            let orderBy = document.getElementById('orderByOptions').value.trim();
            if (orderBy !== '') {
                uri += `&$orderby=${orderBy}`;
            }
            let filter = document.getElementById('filterOptions').value.trim();
            if (filter !== '') {
                uri += `&$filter=${filter}`;
            }
            let select = document.getElementById('selectOptions').value.trim();
            if (select !== '') {
                uri += `&$select=${select}`;
            }
            document.getElementById('queryUrl').value = uri;
            let request = {
                requestUri: uri,
                method: "GET",
                headers: { Accept: "application/json;odata.metadata=full;odata.streaming=true" }
            };
            odatajs.oData.request(
                request,
                function (data, response) {
                    let queryData = data['value'];
                    let count = data['@odata.count'];
                    document.getElementById("totalCountSpan").innerHTML = count;
                    document.getElementById("responseBody").innerHTML = JSON.stringify(queryData, null, 2);

                    const dataSource = {
                        rowCount: undefined, // behave as infinite scroll
                        getRows: function (params) {   
                            let lastRow = -1;
                            if (queryData.length <= params.endRow) {
                                lastRow = queryData.length;
                            }
                            params.successCallback(queryData, lastRow);
                        },
                    };
                    gridOptions.api.setDatasource(dataSource);
                },
                function (err) {
                    alertNotic(err, "danger");
                }
            );
        };

        // specify the columns
        let columnDefs = [];
        // let the grid know which columns and what data to use
        let gridOptions = {
            columnDefs: columnDefs,
            multiSortKey: 'ctrl',
            defaultColDef: {
                unSortIcon: true,
                resizable: true,
                //headerCheckboxSelection: isFirstColumn,
                //checkboxSelection: isFirstColumn,
            },
            rowModelType:'infinite',
            onSortChanged: function (params) {
                console.log(params);
                let sortItems = [];
                params.columnApi.getColumnState().forEach(function (item, index) {
                    if (item.sort != null) {
                        sortItems.push(item);
                    }
                });
                let orderByOptions = [];
                sortItems.sort(function (a,b) {
                    return a.sortIndex - b.sortIndex;
                });
                sortItems.forEach(function (item, index) {
                    orderByOptions.push(`${item.colId} ${item.sort}`);
                });
                document.getElementById('orderByOptions').value = orderByOptions.join(',');
                document.getElementById("pageOptions").value = 1;
                document.getElementById("skipOptions").value = 0;
                queryEntityDataSet();
            },
            rowData: [],
            rowSelection: 'single', //multiple
            //rowMultiSelectWithClick: true,
            onFilterChanged: onFilterChanged,
        };

        // lookup the container we want the Grid to use
        const eGridDiv = document.querySelector('#myGrid');

        // create the grid passing in the div to use together with the columns & data we want to use
        new agGrid.Grid(eGridDiv, gridOptions);

        function getSelectedRows() {
            const selectedNodes = gridOptions.api.getSelectedNodes()
            const selectedData = selectedNodes.map(node => node.data)
            return selectedData.map(d => d["@odata.id"]);
        }

        function isFirstColumn(params) {
            var displayedColumns = params.columnApi.getAllDisplayedColumns();
            var thisIsFirstColumn = displayedColumns[0] === params.column;
            return thisIsFirstColumn;
        }

        function clearSort() {
            gridOptions.columnApi.applyColumnState({
                defaultState: { sort: null },
            });
            document.getElementById("pageOptions").value = 1;
            document.getElementById("skipOptions").value = 0;
            queryEntityDataSet();
        }

        function clearFilter() {
            gridOptions.api.setFilterModel(null);
            document.getElementById("pageOptions").value = 1;
            document.getElementById("skipOptions").value = 0;
            queryEntityDataSet();
        }

        function onFilterChanged(params) {
            let filterModel = params.api.getFilterModel();
            console.log(filterModel);
            let filterOptions = [];
            let keys = Object.keys(filterModel);
            keys.forEach(function (item, index) {
                switch (filterModel[item].type) {
                    case "equals":
                        if (filterModel[item].filterType === 'number')
                            filterOptions.push(`${item} eq ${filterModel[item].filter}`);
                        else
                            filterOptions.push(`${item} eq '${filterModel[item].filter}'`);
                        break;
                    case "notEqual":
                        if (filterModel[item].filterType === 'number')
                            filterOptions.push(`${item} ne ${filterModel[item].filter}`);
                        else
                            filterOptions.push(`${item} ne '${filterModel[item].filter}'`);
                        break;
                    case "contains":
                        filterOptions.push(`contains(${item},'${filterModel[item].filter}')`);
                        break;
                    case "notContains":
                        filterOptions.push(`not contains(${item},'${filterModel[item].filter}')`);
                        break;
                    case "startsWith":
                        filterOptions.push(`startsWith(${item},'${filterModel[item].filter}')`);
                        break;
                    case "endsWith":
                        filterOptions.push(`endsWith(${item},'${filterModel[item].filter}')`);
                        break;
                    case "lessThan":
                        filterOptions.push(`${item} lt ${filterModel[item].filter}`);
                        break;
                    case "lessThanOrEqual":
                        filterOptions.push(`${item} le ${filterModel[item].filter}`);
                        break;
                    case "greaterThan":
                        filterOptions.push(`${item} gt ${filterModel[item].filter}`);
                        break;
                    case "greaterThanOrEqual":
                        filterOptions.push(`${item} ge ${filterModel[item].filter}`);
                        break;
                    case "inRange":
                        filterOptions.push(`${item} ge ${filterModel[item].filter} and ${item} le ${filterModel[item].filterTo}`);
                        break;
                    case "blank":
                        filterOptions.push(`${item} eq null`);
                        break;
                    case "notBlank":
                        filterOptions.push(`${item} ne null`);
                        break;
                    case "empty":
                        filterOptions.push(`${item} eq null`);
                        break;
                    default:
                        break;
                }
            });
            document.getElementById('filterOptions').value = filterOptions.join(' and ');
            document.getElementById("pageOptions").value = 1;
            document.getElementById("skipOptions").value = 0;
            queryEntityDataSet();
        }

        var viewModal = new bootstrap.Modal(document.getElementById('viewModal'));
        // 查看
        function viewDetail() {
            let resourceUris = getSelectedRows();
            if (resourceUris.length > 0) {
                resourceUris.forEach(function (item, index) {
                    queryEntityData(item);
                });
                viewModal.show();
            } else {
                alertNotic('请选择需要查看的数据', "warning");
            }
        }

        var confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
        // 删除确认
        function confirmDelete() {
            let resourceUris = getSelectedRows();
            if (resourceUris.length > 0) {
                confirmModal.show();
            } else {
                alertNotic('请选择需要删除的数据', "warning");
            }
        }

        // 删除
        function deleteResource() {
            let resourceUris = getSelectedRows();
            resourceUris.forEach(function (item, index) {
                let request = {
                    requestUri: item,
                    method: "DELETE",
                    headers: { Accept: "application/json;odata.metadata=full;odata.streaming=true" }
                };
                odatajs.oData.request(
                    request,
                    function (data, response) {
                        alertNotic('删除数据成功',"success");
                        queryEntityDataSet();
                    },
                    function (err) {
                        alertNotic("Something went wrong.","danger");
                    }
                );
            });
            confirmModal.hide();
        }

        // 查询Entity数据
        function queryEntityData(entityUri) {
            let request = {
                requestUri: entityUri,
                method: "GET",
                headers: { Accept: "application/json;odata.metadata=full;odata.streaming=true", }
            };
            odatajs.oData.request(
                request,
                function (data, response) {
                    entitySetVm._data.selectedEntityData = data;
                },
                function (err) {
                    alertNotic("Something went wrong", "danger");
                }
            );
        }

        // 新建Entity数据
        function createNewRecord() {
            location.href = `edit.html?entitySetId=${entitySetVm._data.currentEntitySet.id}`;
        }

        // 编辑Entity数据
        function editRecord() {
            let resourceUris = getSelectedRows();
            if (resourceUris.length > 0) {
                resourceUris.forEach(function (item, index) {
                    location.href = `edit.html?entitySetId=${entitySetVm._data.currentEntitySet.id}&resourceUri=${item}`;
                });                
            } else {
                alertNotic('请选择需要编辑的数据', "warning");
            }            
        }
    </script>
</body>
</html>